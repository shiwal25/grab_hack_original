<!doctype html>
<html>
<head><meta charset="utf-8"><title>SocketIO Test</title></head>
<body style="background-color: black; color: white;">
  <h3>Socket.IO test UI</h3>
  <button id="start">Start Session</button>
  <div id="log" style="white-space:pre-wrap;color: white; border:1px solid #ccc; padding:8px; height:300px; overflow:auto;"></div>
  <input id="text" placeholder="type reply"/>
  <button id="send">Send Reply</button>

  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script>
    const log = (t)=> (document.getElementById('log').textContent += t + '\n');
    const socket = io('http://localhost:3001');
    document.getElementById('start').onclick = () => {
      socket.emit('start_session', { user_id: 'webtester', location: 'Lucknow, India', situation: "Recipient not available" });
      log('start_session sent');
    };
    socket.on('agent_response', (evt) => {
      log('AGENT_EVENT: ' + JSON.stringify(evt));
      if (evt.type === 'message' && evt.role === 'agent') log('AGENT SAYS: ' + evt.content);
      if (evt.type === 'prompt') log('AGENT PROMPT: ' + evt.message);
    });
    socket.on('error_message', (e) => log('PY ERROR: ' + e));
    document.getElementById('send').onclick = () => {
      const txt = document.getElementById('text').value;
      socket.emit('send_user_input', { input: txt });
      log('SENT: ' + txt);
      document.getElementById('text').value = '';
    };
  </script>
</body>
</html>
